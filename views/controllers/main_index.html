<link rel="import" href="{$components_url}bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="{$components_url}bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/iron-icons.html">
<link rel="import" href="{$components_url}bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-fab/paper-fab.html">
<link rel="import" href="{$components_url}bower_components/paper-fab-transitions/paper-fab-speed-dial.html">
<link rel="import" href="{$components_url}bower_components/paper-menu/paper-menu.html">
<link rel="import" href="{$components_url}bower_components/paper-item/paper-item.html">

<link rel="import" href="{$components_url}controllets/paper-card-controllet/paper-card-controllet.html"/>
<link rel="import" href="{$components_url}controllets/search-panel-controllet/search-panel-controllet.html"/>
<link rel="import" href="{$components_url}controllets/animated-grid-controllet/animated-grid-controllet.html"/>
<link rel="import" href="{$components_url}controllets/fullsize-page-with-card-controllet/fullsize-page-with-card-controllet.html">
<link rel="import" href="{$components_url}controllets/room-controllet/room-controllet.html">

<link rel="import" href="{$components_url}bower_components/paper-card/paper-card.html">
<link rel="import" href="{$components_url}bower_components/paper-button/paper-button.html">
<link rel="import" href="{$components_url}bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="{$components_url}bower_components/paper-styles/color.html">


<link rel="import" href="{$components_url}bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="{$components_url}bower_components/paper-styles/paper-styles.html">
<link rel="import" href="{$components_url}bower_components/neon-animation/neon-animations.html">

<link rel="import" href="{$components_url}bower_components/polymer-element-catalog/app/elements/app-sidebar/app-sidebar.html">


{literal}
<style is="custom-style">

    paper-toolbar.toolbar-main
    {
        --paper-toolbar-background:#2196F3;
        -moz-box-shadow: 0 0 20px 5px #999;
        -webkit-box-shadow: 0 0 20px 5px #999;
    }

    paper-fab
    {
        position: absolute;
        bottom: 55px;
        right: 40px;
        --paper-fab-background:#2196F3;
    }

    .ow_console_right {
        position: absolute;
        right: 0px;
    }

</style>

<script type="text/javascript">
    $(document).ready(function () {

       var scope = document.querySelector('template[is="dom-bind"]');

        scope._onTileClick = function(event) {
            $("#add_room_button").hide();
            this.$['fullsize-card'].color      = event.detail.data.color;
            this.$['fullsize-card'].publicRoom = event.detail.data.id;
            ODE.publicRoom = event.detail.data.id;
            this.$.pages.selected = 1;
        };

        scope._onFullsizeClick = function(event) {
            $("#add_room_button").show();
            this.$['fullsize-card'].publicRoom = undefined;
            this.$.pages.selected = 0;
        };

        window.addEventListener('fullsize-page-with-card-controllet_attached', function(){
            var match = window.location.hash.match(/\/[0-9]*/g);
            if(match)
            {
                var roomId = match[0].replace("/","");
                $("#add_room_button").hide();
                $("#fullsize-card")[0].color = $("#"+roomId).css('background-color');
                $("#fullsize-card")[0].publicRoom = roomId;
                ODE.publicRoom = roomId;
                $("#pages")[0].selected = 1;
            }
        });

    });

    function addRoom(event)
    {
        previewFloatBox.close();
        var room = createRoom(event);
        $('.grid').prepend(room).masonry('reloadItems').masonry('layout');
    }

    function createRoom(event)
    {
        var room = document.createElement('div');
        room.setAttribute('id', event.id);
        room.setAttribute('class', 'grid-item grid-item-w20 grid-item-h200 grid-item-c4');

        var roomBody = document.createElement('div');
        roomBody.setAttribute('class', 'room-body');
        roomBody.innerHTML = event.body;

        var  roomSubject = document.createElement('div');
        roomSubject.setAttribute('class', 'room-subject');
        roomSubject.innerHTML = event.subject;

        room.appendChild(roomBody);
        room.appendChild(roomSubject);

        return room;
    }
</script>
{/literal}

<paper-drawer-panel force-narrow>

    <div drawer>

        <paper-toolbar class="toolbar-drawer">
            <div class="title">Options</div>
        </paper-toolbar>

        <app-sidebar drawer>
            <paper-menu>
                {foreach $userPublicRooms as $userRoom}
                    <paper-item onclick="SPODPUBLICROOM.handleSuggestedDataset({$userRoom->id})">
                        <!--<iron-icon icon="warning"></iron-icon>-->
                        <paper-item-body two-lines>
                            <div>{$userRoom->subject}</div>
                        </paper-item-body>
                    </paper-item>
                {/foreach}
            </paper-menu>
        </app-sidebar>

    </div>

    <div main class="fullbleed layout vertical">

        <paper-toolbar class="toolbar-main">
            <paper-icon-button paper-drawer-toggle icon="menu" on-tap="menuAction"></paper-icon-button>
            <!--<div class="title">Agora</div>-->
            <div class="clearfix" style="background-color:#2196F3;">
                <a class="ow_logo ow_left" href="{$siteUrl}"></a>
                <div class="ow_nav_btn"></div>
                <div class="ow_console_right">
                    {$console}
                </div>
                <div class="ow_menu_wrap">{component class='BASE_CMP_MainMenu' responsive=true}</div>
            </div>
            <!--<search-panel-controllet right-direction="true"></search-panel-controllet>-->
            <!--<paper-icon-button icon="more-vert" on-tap="moreAction"></paper-icon-button>-->
        </paper-toolbar>

        <paper-scroll-header-panel class="flex" fixed>

            <template is="dom-bind">
                <neon-animated-pages id="pages" selected="0" style="height: 100%; width: 100%;">

                    <animated-grid-controllet on-tile-click="_onTileClick">
                        {foreach $rooms as $room}
                            <!--<div id="{$room->id}" openData="{$room->opendata}" class="grid-item

                                    {if $room->opendata > $openDataMedian}
                                        grid-item-w40
                                    {else}
                                        grid-item-w20
                                    {/if}

                                    {if $room->comments > $commentsMedian}
                                        grid-item-h400
                                    {else}
                                        grid-item-h200
                                    {/if}
                                    "
                                    style="background-color:#{$room->color}">

                                <div class="room-body"><span>{$room->body}</span></div>
                                <div class="room-subject"><span>{$room->subject}</span></div>
                                <div class="room-timestamp">{$room->timestamp}</div>
                            </div>-->
                            <room-controllet
                                room-owner="{$room->owner}"
                                room-shape='["{$room->colorStep}",{if $room->comments > $commentsMedian}"many"{else}"few"{/if},{if $room->opendata > $openDataMedian}"many"{else}"few"{/if}]'
                                room-id="{$room->id}"
                                body="{$room->body}"
                                subject="{$room->subject}"
                                timestamp="{$room->timestamp}"
                                room-color="#{$room->color}"
                                datasets="{$room->opendata}"
                                comments="{$room->comments}"
                                room-width={if $room->opendata > $openDataMedian}"grid-item-w40"{else}"grid-item-w20"{/if}
                                room-height={if $room->comments > $commentsMedian}"grid-item-h400"{else}"grid-item-h200"{/if}
                                room-views={$room->views}
                            ></room-controllet>
                        {/foreach}
                    </animated-grid-controllet>

                    <fullsize-page-with-card-controllet id="fullsize-card" hero-id="hero" on-click="_onFullsizeClick">
                    </fullsize-page-with-card-controllet>

                </neon-animated-pages>
            </template>

        </paper-scroll-header-panel>

        {literal}
            <paper-fab id="add_room_button" icon="add" onclick="SPODPUBLICROOM.addRoom()"></paper-fab>
        {/literal}

    </div>

</paper-drawer-panel>