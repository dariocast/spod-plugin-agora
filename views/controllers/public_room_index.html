<link rel="import" href="{$components_url}bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="{$components_url}bower_components/paper-material/paper-material.html">
<link rel="import" href="{$components_url}bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/iron-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="{$components_url}datalets/graph-datalet/graph-datalet.html">

<style is="custom-style">

    paper-toolbar.toolbar-main
    {
        --paper-toolbar-background:#2196F3;
        -moz-box-shadow: 0 0 20px 5px #999;
        -webkit-box-shadow: 0 0 20px 5px #999;
        z-index : 100;
    }
    paper-toolbar.title-header{
        --paper-toolbar-background:#2196F3;
        -moz-box-shadow: 0 0 20px 5px #999;
        -webkit-box-shadow: 0 0 20px 5px #999;
        margin-bottom: 10px;
        height: 50px;
    }
    paper-fab{
        --paper-fab-background:#2196F3;
    }
    paper-header-panel{
        height: 12vh;;
    }

    .title h3{
        color: #ffffff;
    }

    paper-toolbar.toolbar-graph
    {
        --paper-toolbar-background:#2196F3;
        -moz-box-shadow: 0 0 20px 5px #999;
        -webkit-box-shadow: 0 0 20px 5px #999;
        height: 50px;
        z-index: 100;
        margin-left: 10px;
        margin-right: 10px;
    }

    #graph_container{
        margin-top: 25px;
        width: 48%;
        display: none;

    }

    #graph_content{
        position: relative;
        overflow: auto;
        height: 80vh;
    }

    #topic_container{
        position: relative;
        overflow: auto;
        height: 93vh;
        width: 100%;
        margin-left: 30px;
    }

    #pr_body{
        font-family: 'Roboto', sans-serif;
        display: inline-block;
        color: #6c6c6c;
        font-weight: bolder;
        font-size: 20px;
        margin: 30px;
        padding-bottom: 50px;
        padding-right: 10px;
        padding-left: 10px;
        font-style: italic;
        margin-top: 25px;
    }

    .q-comments{
        padding-left: 30px;
        width: 90%;
    }
</style>

{style}
    #button_container { display: none; }
{/style}

{literal}
<script>

    var last_selected_element = null;
    window.addEventListener('graph-datalet_node-clicked', function(e){
        if(last_selected_element != null){
            last_selected_element.css('border', 'none');
            last_selected_element.css('font-weight', 'normal');
        }

        if(e.detail.node.id == 0) return;

        var curr_element = $("#comment_" + e.detail.node.originalId);
        $(curr_element).css('border', '1px solid #000000');
        $(curr_element).css('font-weight', 'bold');

        $('div[id^="nc_"]').css('display', 'none');
        $(curr_element).parents('div[id^="nc_"]').css('display', 'block');

        $("#topic_container").scrollTop($(curr_element).offset().top);

        last_selected_element = curr_element;
    });

    slideGraphPanel = function(){
        $('#graph_container').toggle('slide', {direction: 'right'}, 300, function(){
            $('#topic_container').css('width' , ($('#graph_container').css('display') == 'none') ? '100%' : '50%');
        });
    };

    dataletGraphShow = function(){
        $.post( SPODPUBLICROOM.get_graph_url,
                {
                    id : SPODPUBLICROOM.public_room_id,
                    type : "datalet"
                },
                function(data, status){
                    data = JSON.parse(data);
                    if(data.status == "ok"){
                        $("#graph_content").html('<graph-datalet data=\'' + data.graph + '\'></graph-datalet>');

                    }
                }
        );
    };

    commentGraphShow = function(){

        $.post( SPODPUBLICROOM.get_graph_url,
                {
                    id : SPODPUBLICROOM.public_room_id,
                    type : "comment"
                },
                function(data, status){
                    data = JSON.parse(data);
                    if(data.status == "ok"){
                        $("#graph_content").html("<graph-datalet data='" + data.graph + "'></graph-datalet>");

                    }
                }
        );

    }

    $(document).ready(function () {
        $('#topic_container').perfectScrollbar();
        $('#graph_content').perfectScrollbar();

    });
</script>
{/literal}

<paper-header-panel>
    <paper-toolbar class="toolbar-main">
        <div class="title"><h3>{$public_room->subject}</h3></div>
        <paper-icon-button paper-drawer-toggle icon="language" onClick="slideGraphPanel()"></paper-icon-button>
    </paper-toolbar>
</paper-header-panel>

<div class="layout horizontal">
        <paper-material id="topic_container" class="layout vertical justified">
            <paper-material elevation="0" id="pr_body">
                <paper-toolbar class="title-header"><h5 style="color:#ffffff;">About this topic</h5></paper-toolbar>
                {$public_room->body}
            </paper-material>
            {if !empty($comments)}
            <div class="q-comments">
                {$comments}
            </div>
            {/if}
        </paper-material>

        <paper-material elevation="1" animated id="graph_container">
            <paper-toolbar class="toolbar-graph">
                <paper-icon-button id="datalet_graph" paper-drawer-toggle icon="assessment" onClick="dataletGraphShow()"></paper-icon-button>
                <paper-icon-button id="comment_graph" paper-drawer-toggle icon="speaker-notes" onClick="commentGraphShow()"></paper-icon-button>
            </paper-toolbar>
            <div id="graph_content">
            </div>
        </paper-material>
</div>

<!-- ODE PRIVATE-ROOM -->
<div>
    {if isset($private_room)}
    {$private_room}
    {/if}
</div>
<!-- ODE PRIVATE-ROOM -->